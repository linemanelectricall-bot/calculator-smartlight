<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Lighting Planner Premium</title>
<style>
body{margin:0;padding:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana,sans-serif;background:#f5f7fa;color:#333;}
header{background:linear-gradient(90deg,#0077cc,#00aaff);color:#fff;padding:40px 20px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.2);}
header h1{font-size:2.8em;margin:0;font-weight:700;text-shadow:0 3px 6px rgba(0,0,0,0.3);}
header p{margin-top:8px;font-size:1.2em;opacity:0.9;}
.wrap{max-width:1100px;margin:30px auto;padding:0 20px;}
.card{background:#fff;padding:25px;margin-bottom:25px;border-radius:15px;box-shadow:0 6px 20px rgba(0,0,0,0.1);transition:0.3s;}
.card:hover{box-shadow:0 8px 25px rgba(0,0,0,0.15);}
button.btn{padding:12px 25px;margin:5px;border:none;border-radius:10px;cursor:pointer;font-weight:600;transition:0.3s;}
button.btn:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
button.mode-btn{background:#0077cc;color:#fff;}
button.mode-btn.active{background:#00aaff;box-shadow:0 0 20px #00aaff;}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:px20;align-items:end;}
/* BESARKAN DROPDOWN / SELECT UNTUK VISUAL PREMIUM */
.input-row input,
.input-row select,
#kategori,
#ruangan,
#lampSelect {
  flex:1;
  padding:13px 11px;      /* padding lebih tebal */
  font-size:1.2em;        /* ukuran teks lebih besar */
  border-radius:10px;     /* sudut lebih bulat */
  border:1px solid #ccc;
  cursor:pointer;         /* pointer untuk klik */
  transition:0.3s;
  width:100%;
}

.input-row input:focus,
.input-row select:focus,
#kategori:focus,
#ruangan:focus,
#lampSelect:focus {
  border-color:#0077cc;
  box-shadow:0 0 10px #00aaff inset;
}
.input-row input:focus,.input-row select:focus{border-color:#0077cc;box-shadow:0 0 15px #00aaff inset;}
label{display:block;margin-bottom:10px;font-weight:600;}

.result-block{margin-top:20px;padding:20px;border:1px dashed #0077cc;border-radius:10px;background:#f9f9f9;white-space:pre-wrap;font-family:monospace;}
canvas{border:1px solid #0077cc;border-radius:12px;margin-top:15px;}
.hidden{display:none;}
footer{text-align:center;padding:20px;background:#e0e0e0;margin-top:40px;font-weight:600;border-top:1px solid #ccc;}
.warning{color:red;font-weight:700;margin-top:10px;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
table,th,td{border:1px solid #0077cc;}
th,td{padding:8px;text-align:center;}
th{background:#00aaff;color:#fff;}
button.addLamp{padding:6px 12px;margin-top:5px;background:#0077cc;color:#fff;border:none;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>
<header>
<h1>Smart Lighting Planner Premium</h1>
<p>Hitung lampu, layout, Watt & VA sesuai SNI secara profesional</p>
</header>
<div class="wrap">
<div class="card" style="text-align:center;">
<button class="btn mode-btn active" id="btnMode1">Mode 1 — Per Titik</button>
<button class="btn mode-btn" id="btnMode2">Mode 2 — Multi Grup / KKK</button>
</div>

<!-- Mode 1 -->
<div id="mode1" class="card">
<div class="grid-2">
<div>
<label for="kategori">Kategori Ruangan</label>
<select id="kategori"><option value="" disabled selected>-- Pilih Kategori --</option></select>
</div>
<div>
<label for="ruangan">Jenis Ruangan</label>
<select id="ruangan"><option value="" disabled selected>-- Pilih Ruangan --</option></select>
</div>
</div>
<div class="input-row">
<div>
<label for="length">Panjang (m)</label>
<input type="number" id="length" placeholder="contoh: 5">
</div>
<div>
<label for="width">Lebar (m)</label>
<input type="number" id="width" placeholder="contoh: 4">
</div>
<div>
<label for="eta">Efisiensi η (0-1)</label>
<input type="number" id="eta" step="0.01" value="0.8">
</div>
</div>
<div style="margin-top:20px;">
<label for="lampSelect">Pilih Lampu</label>
<select id="lampSelect"><option value="" disabled selected>-- Pilih Lampu --</option></select>
</div>
<button class="btn mode-btn primary" id="calcMode1">Hitung & Tampilkan Layout</button>
<div id="warning" class="warning hidden"></div>
<div id="resultMode1" class="result-block"></div>
<canvas id="layoutCanvas" width="700" height="450"></canvas>
</div>

<!-- Mode 2 -->
<div id="mode2" class="card hidden">
<div class="grid-2">
<div>
<label for="kkkCount">Jumlah KKK</label>
<input type="number" id="kkkCount" placeholder="contoh: 2">
</div>
<div>
<label for="mcbType">Tipe Phase</label>
<select id="mcbType"><option value="1phase">1 Phase</option><option value="3phase">3 Phase</option></select>
</div>
<div>
<label for="effMode2">Efisiensi η (0-1)</label>
<input type="number" id="effMode2" step="0.01" value="0.8">
</div>
</div>
<div id="groupsContainer"></div>
<button class="btn addLamp" id="addGroup">Tambah Grup Lampu</button>
<button class="btn primary" id="calcMode2">Hitung Mode 2</button>
<div id="resultMode2" class="result-block"></div>
</div>
</div>
<footer>
&copy; <span id="year"></span> by.@bah
</footer>

<script>
// ===== Data ROOMS & LAMPS =====
const ROOMS=[
{key:"teras_rumah", name:"Teras (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:100},
{key:"ruang_tamu", name:"Ruang Tamu (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:150},
{key:"kamar_tidur", name:"Kamar Tidur (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:150},
{key:"dapur", name:"Dapur (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:250},
{key:"garasi", name:"Garasi (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:75},
{key:"koridor_rumah", name:"Koridor (Rumah Tinggal)", kategori:"Rumah Tinggal", lux:100},
{key:"ruang_direktur", name:"Ruang Direktur (Perkantoran)", kategori:"Perkantoran", lux:350},
{key:"ruang_rapat", name:"Ruang Rapat (Perkantoran)", kategori:"Perkantoran", lux:300},
{key:"ruang_komputer", name:"Ruang Komputer (Perkantoran)", kategori:"Perkantoran", lux:500},
{key:"ruang_arsip", name:"Ruang Arsip (Perkantoran)", kategori:"Perkantoran", lux:200},
{key:"resepsionis", name:"Resepsionis (Perkantoran)", kategori:"Perkantoran", lux:300},
{key:"open_office", name:"Ruang Kerja Terbuka (Perkantoran)", kategori:"Perkantoran", lux:350},
{key:"kelas", name:"Ruang Kelas (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:300},
{key:"lab_fisika", name:"Laboratorium Fisika (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:500},
{key:"lab_komputer", name:"Laboratorium Komputer (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:500},
{key:"perpustakaan", name:"Perpustakaan (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:300},
{key:"ruang_gambar", name:"Ruang Gambar (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:750},
{key:"aula", name:"Aula / Auditorium (Lembaga Pendidikan)", kategori:"Lembaga Pendidikan", lux:200},
{key:"lobi_hotel", name:"Lobi Hotel (Hotel & Restoran)", kategori:"Hotel & Restoran", lux:200},
{key:"kamar_hotel", name:"Kamar Hotel (Hotel & Restoran)", kategori:"Hotel & Restoran", lux:150},
{key:"ruang_makan", name:"Ruang Makan (Hotel & Restoran)", kategori:"Hotel & Restoran", lux:200},
{key:"dapur_restoran", name:"Dapur Restoran (Hotel & Restoran)", kategori:"Hotel & Restoran", lux:500},
{key:"bar", name:"Bar / Lounge (Hotel & Restoran)", kategori:"Hotel & Restoran", lux:150},
{key:"ruang_operasi", name:"Ruang Operasi (Rumah Sakit)", kategori:"Rumah Sakit", lux:1000},
{key:"icu", name:"ICU (Rumah Sakit)", kategori:"Rumah Sakit", lux:300},
{key:"rawat_inap", name:"Ruang Rawat Inap (Rumah Sakit)", kategori:"Rumah Sakit", lux:200},
{key:"lab_klinik", name:"Laboratorium Klinik (Rumah Sakit)", kategori:"Rumah Sakit", lux:750},
{key:"farmasi", name:"Farmasi / Apotek (Rumah Sakit)", kategori:"Rumah Sakit", lux:500},
{key:"koridor_rumah_sakit", name:"Koridor (Rumah Sakit)", kategori:"Rumah Sakit", lux:150},
{key:"produksi_kasar", name:"Produksi Kasar (Industri)", kategori:"Industri", lux:200},
{key:"perakitan_presisi", name:"Perakitan Presisi (Industri)", kategori:"Industri", lux:1000},
{key:"gudang", name:"Gudang (Industri)", kategori:"Industri", lux:150},
{key:"ruang_kontrol", name:"Ruang Kontrol (Industri)", kategori:"Industri", lux:500},
{key:"maintenance", name:"Workshop / Maintenance (Industri)", kategori:"Industri", lux:300},
{key:"supermarket", name:"Supermarket (Pertokoan & Mall)", kategori:"Pertokoan & Mall", lux:750},
{key:"etalase", name:"Etalase / Display (Pertokoan & Mall)", kategori:"Pertokoan & Mall", lux:1000},
{key:"area_kasir", name:"Area Kasir (Pertokoan & Mall)", kategori:"Pertokoan & Mall", lux:500},
{key:"area_parkir", name:"Area Parkir Basement (Pertokoan & Mall)", kategori:"Pertokoan & Mall", lux:75},
{key:"foodcourt", name:"Foodcourt (Pertokoan & Mall)", kategori:"Pertokoan & Mall", lux:300},
{key:"jalan_utama", name:"Jalan Utama (Jalan & Transportasi)", kategori:"Jalan & Transportasi", lux:20},
{key:"jalan_lingkungan", name:"Jalan Lingkungan (Jalan & Transportasi)", kategori:"Jalan & Transportasi", lux:10},
{key:"terminal", name:"Terminal (Jalan & Transportasi)", kategori:"Jalan & Transportasi", lux:150},
{key:"stasiun", name:"Stasiun Kereta (Jalan & Transportasi)", kategori:"Jalan & Transportasi", lux:200},
{key:"bandara", name:"Bandara / Ruang Tunggu (Jalan & Transportasi)", kategori:"Jalan & Transportasi", lux:300}
];

const LAMPS=[
{index:0,name:"LED Philips 5W",watt:5,lumen:450},
{index:1,name:"LED Philips 7W",watt:7,lumen:600},
{index:2,name:"LED Philips 9W",watt:9,lumen:800},
{index:3,name:"LED Philips 12W",watt:12,lumen:1055},
{index:4,name:"LED Philips 15W",watt:15,lumen:1300},
{index:5,name:"LED Philips 18W",watt:18,lumen:1500},
{index:6,name:"LED Panasonic 5W",watt:5,lumen:420},
{index:7,name:"LED Panasonic 9W",watt:9,lumen:850},
{index:8,name:"LED Panasonic 12W",watt:12,lumen:1100},
{index:9,name:"LED Panasonic 18W",watt:18,lumen:1600},
{index:10,name:"LED Osram 5W",watt:5,lumen:400},
{index:11,name:"LED Osram 10W",watt:10,lumen:900},
{index:12,name:"LED Osram 15W",watt:15,lumen:1400},
{index:13,name:"LED Osram 20W",watt:20,lumen:1800},
{index:14,name:"Lampu TL 18W",watt:18,lumen:1200},
{index:15,name:"Lampu TL 36W",watt:36,lumen:3350},
{index:16,name:"Lampu TL 40W",watt:40,lumen:3600},
{index:17,name:"Lampu TL 58W",watt:58,lumen:4000},
{index:18,name:"Lampu TL 80W",watt:80,lumen:5400},
{index:19,name:"Downlight LED 5W",watt:5,lumen:450},
{index:20,name:"Downlight LED 10W",watt:10,lumen:900},
{index:21,name:"Downlight LED 12W",watt:12,lumen:1000},
{index:22,name:"Downlight LED 18W",watt:18,lumen:1500},
{index:23,name:"Spotlight LED 5W",watt:5,lumen:400},
{index:24,name:"Spotlight LED 10W",watt:10,lumen:900},
{index:25,name:"Spotlight LED 15W",watt:15,lumen:1400},
{index:26,name:"Spotlight LED 20W",watt:20,lumen:1800},
{index:27,name:"Floodlight LED 20W",watt:20,lumen:1800},
{index:28,name:"Floodlight LED 30W",watt:30,lumen:2700},
{index:29,name:"Floodlight LED 50W",watt:50,lumen:4500},
{index:30,name:"Floodlight LED 70W",watt:70,lumen:6300},
{index:31,name:"Floodlight LED 100W",watt:100,lumen:9000}
];

// ===== Populate dropdowns =====
const kategoriEl=document.getElementById("kategori");
const ruanganEl=document.getElementById("ruangan");
const lampSelect=document.getElementById("lampSelect");
const kategoriList=[...new Set(ROOMS.map(r=>r.kategori))];
kategoriList.forEach(k=>{let opt=document.createElement("option");opt.value=k;opt.textContent=k;kategoriEl.appendChild(opt);});
kategoriEl.addEventListener("change",()=>{ruanganEl.innerHTML='<option value="" disabled selected>-- Pilih Ruangan --</option>';ROOMS.filter(r=>r.kategori==kategoriEl.value).forEach(r=>{let opt=document.createElement("option");opt.value=r.key;opt.textContent=r.name;ruanganEl.appendChild(opt);});});
LAMPS.forEach(l=>{let opt=document.createElement("option");opt.value=l.index;opt.textContent=l.name+" ["+l.watt+"W | "+l.lumen+"lm]";lampSelect.appendChild(opt);});

// ===== Mode Switch =====
const btnMode1=document.getElementById("btnMode1");
const btnMode2=document.getElementById("btnMode2");
const mode1Div=document.getElementById("mode1");
const mode2Div=document.getElementById("mode2");
btnMode1.addEventListener("click",()=>{mode1Div.classList.remove("hidden");mode2Div.classList.add("hidden");btnMode1.classList.add("active");btnMode2.classList.remove("active");});
btnMode2.addEventListener("click",()=>{mode2Div.classList.remove("hidden");mode1Div.classList.add("hidden");btnMode2.classList.add("active");btnMode1.classList.remove("active");});

document.getElementById("year").textContent=new Date().getFullYear();

// ===== Canvas =====
const canvas=document.getElementById("layoutCanvas");
const ctx=canvas.getContext("2d");
function drawLayout(points){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  points.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,12,0,2*Math.PI);ctx.fillStyle="#00aaff";ctx.fill();ctx.strokeStyle="#0077cc";ctx.lineWidth=2;ctx.stroke();});
}

// ===== Mode 1 Calculation (lanjutan) =====
document.getElementById("calcMode1").addEventListener("click",()=>{
  const ruanganKey=ruanganEl.value;
  const lampIdx=parseInt(lampSelect.value);
  const length=parseFloat(document.getElementById("length").value);
  const width=parseFloat(document.getElementById("width").value);
  const eta=parseFloat(document.getElementById("eta").value);
  const warningEl=document.getElementById("warning");
  warningEl.classList.add("hidden"); warningEl.textContent="";
  if(!ruanganKey||isNaN(lampIdx)||isNaN(length)||isNaN(width)){alert("Isi semua field!");return;}
  const ruangan=ROOMS.find(r=>r.key==ruanganKey);
  const lamp=LAMPS.find(l=>l.index==lampIdx);
  const area=length*width;
  const totalLum=ruangan.lux*area/eta;
  const lampCount=Math.ceil(totalLum/lamp.lumen);
  const va=lamp.watt*lampCount;
  const arus=va/220;

  // Layout grid
  const points=[]; 
  const cols=Math.ceil(Math.sqrt(lampCount)); 
  const rows=Math.ceil(lampCount/cols);
  for(let r=0;r<rows;r++){
    let rowCount=(r<rows-1)?cols:(lampCount-(cols*(rows-1)));
    for(let c=0;c<rowCount;c++){
      points.push({x:(c+1)*canvas.width/(cols+1), y:(r+1)*canvas.height/(rows+1)});
    }
  }
  drawLayout(points);
  if(rows*cols!==lampCount){warningEl.textContent="⚠ Jumlah lampu per baris tidak merata!";warningEl.classList.remove("hidden");}

  document.getElementById("resultMode1").textContent=
`Ruangan: ${ruangan.name}
Luas: ${area.toFixed(2)} m²
Lux Standar: ${ruangan.lux} lx
Lampu Pilihan: ${lamp.name} (${lamp.watt}W | ${lamp.lumen}lm)
Jumlah Lampu: ${lampCount} buah
Total Watt (VA): ${va} W
Arus (A): ${arus.toFixed(2)} A`;
});

// ===== Mode 2 Dynamic Groups =====
const groupsContainer=document.getElementById("groupsContainer");
let groupCount=0;
document.getElementById("addGroup").addEventListener("click",()=>{
  groupCount++;
  const groupDiv=document.createElement("div");
  groupDiv.classList.add("card");
  groupDiv.style.marginTop="15px";
  groupDiv.id="group_"+groupCount;
  groupDiv.innerHTML=`
<h3>Grup Lampu ${groupCount}</h3>
<div class="input-row">
  <div>
    <label>Jumlah Lampu</label>
    <input type="number" class="lampQty" placeholder="Contoh: 5">
  </div>
  <div>
    <label>Pilih Lampu</label>
    <select class="lampType"><option value="" disabled selected>-- Pilih Lampu --</option></select>
  </div>
  <div>
    <label>MCB Grup (A)</label>
    <input type="number" class="mcbGroup" placeholder="Contoh: 10">
  </div>
</div>`;

  // Populate lamp options
  const sel=groupDiv.querySelector(".lampType");
  LAMPS.forEach(l=>{let opt=document.createElement("option");opt.value=l.index;opt.textContent=l.name+" ["+l.watt+"W | "+l.lumen+"lm]";sel.appendChild(opt);});
  groupsContainer.appendChild(groupDiv);
});

// ===== Mode 2 Calculation =====
document.getElementById("calcMode2").addEventListener("click",()=>{
  const kkkCount=parseInt(document.getElementById("kkkCount").value);
  const phase=document.getElementById("mcbType").value;
  const eta=parseFloat(document.getElementById("effMode2").value);
  if(isNaN(kkkCount)||kkkCount<1){alert("Isi jumlah KKK valid!");return;}
  if(groupCount<1){alert("Tambahkan minimal 1 grup lampu!");return;}
  const results=[];
  let totalVA=0, totalAmps=0;
  for(let i=1;i<=groupCount;i++){
    const grp=document.getElementById("group_"+i);
    const qty=parseInt(grp.querySelector(".lampQty").value);
    const lampIdx=parseInt(grp.querySelector(".lampType").value);
    const mcb=parseFloat(grp.querySelector(".mcbGroup").value);
    if(isNaN(qty)||isNaN(lampIdx)||isNaN(mcb)){alert("Isi semua field Grup "+i+"!");return;}
    const lamp=LAMPS.find(l=>l.index==lampIdx);
    const va=(lamp.watt*qty)/eta;
    const arus=va/220;
    totalVA+=va; totalAmps+=arus;
    results.push({grup:i,lamp:lamp.name,qty:qty,va:va.toFixed(2),amp:arus.toFixed(2),mcb:mcb});
  }

  // Generate table
  let html=<table><tr><th>Grup</th><th>Lampu</th><th>Jumlah</th><th>VA</th><th>Arus (A)</th><th>MCB Grup (A)</th></tr>;
  results.forEach(r=>{html+=<tr><td>${r.grup}</td><td>${r.lamp}</td><td>${r.qty}</td><td>${r.va}</td><td>${r.amp}</td><td>${r.mcb}</td></tr>;});
  // MCB Utama
  let mcbMain=0;
  if(phase==="1phase"){mcbMain=Math.ceil(totalAmps);}
  else{mcbMain=Math.ceil(totalAmps/3);}
  html+=<tr><th colspan="3">Total</th><th>${totalVA.toFixed(2)} VA</th><th>${totalAmps.toFixed(2)} A</th><th>MCB Utama: ${mcbMain} A</th></tr></table>;
  document.getElementById("resultMode2").innerHTML=html;
});
</script>
</body>
</html>
