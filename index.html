<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Lighting Planner </title>
<style>
:root {
  --primary: #7c3aed;
  --primary-dark: #5b21b6;
  --bg-light: #f5f7fa;
  --bg-dark: #181022;
  --text-light: #fff;
  --text-dark: #333;
  --card-light: #fff;
  --card-dark: #231b33;
  --border-light: #ccc;
  --border-dark: #555;
}

body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-light);
  color: var(--text-dark);
  transition: 0.4s;
}
body.dark {
  background: var(--bg-dark);
  color: var(--text-light);
}

/* HEADER */
header {
  background: linear-gradient(90deg, var(--primary-dark), var(--primary));
  color: #fff;
  text-align: center;
  padding: 35px 15px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  position: relative;
}
header h1 { margin:0; font-size:2em; }
header p { opacity:0.9; margin:6px 0 0; }
#toggleDark {
  position:absolute; right:15px; top:15px;
  background: rgba(255,255,255,0.15);
  border:none; color:#fff;
  padding:8px 15px; border-radius:10px;
  cursor:pointer; font-weight:600; transition:0.3s;
}
#toggleDark:hover { background: rgba(255,255,255,0.3); }

/* LAYOUT WRAPPER */
.wrap { max-width:1100px; margin:25px auto; padding:0 20px; }
.card {
  background: var(--card-light);
  border-radius:15px;
  padding:25px; margin-bottom:25px;
  box-shadow:0 6px 20px rgba(0,0,0,0.1);
  transition:0.3s;
}
body.dark .card {
  background: var(--card-dark);
  box-shadow:0 4px 15px rgba(255,255,255,0.05);
}

/* BUTTONS */
.btn {
  border:none; padding:10px 20px;
  border-radius:10px; cursor:pointer;
  font-weight:600; margin:5px; transition:0.3s;
}
.btn:hover { transform:translateY(-2px); }
.mode-btn {
  background: var(--primary-dark);
  color:#fff;
}
.mode-btn.active { background: var(--primary); }
button.primary { background: var(--primary); color:#fff; }
button.outline {
  background: transparent;
  border:2px solid var(--primary);
  color: var(--primary);
}
body.dark button.outline {
  border-color:#9d7df5; color:#c8a9ff;
}

/* GRID */
.grid-2 {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}

label { display:block; margin-bottom:6px; font-weight:600; }
input, select {
  width:100%; padding:10px;
  border:1px solid var(--border-light);
  border-radius:10px;
  font-size:1em;
}
body.dark input, body.dark select {
  background:#2e2342;
  color:#fff;
  border-color: var(--border-dark);
}

/* RESULT BLOCK */
.result-block {
  margin-top:15px;
  padding:15px;
  border-radius:10px;
  background:rgba(0,0,0,0.05);
  white-space:pre-wrap;
  font-family:monospace;
}
body.dark .result-block { background:rgba(255,255,255,0.05); }

/* TABLE */
table { width:100%; border-collapse:collapse; margin-top:15px; }
table th, table td {
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}
body.dark table th, body.dark table td { border-color:#444; }
table th {
  background: var(--primary);
  color:#fff;
}

/* SVG layout */
svg {
  width:100%; height:auto;
  margin-top:15px;
  border-radius:10px;
  border:1px solid var(--primary);
}

/* FOOTER */
footer {
  text-align:center;
  padding:20px;
  font-weight:600;
  background: rgba(0,0,0,0.05);
  border-top:1px solid #ccc;
  margin-top:30px;
}
body.dark footer {
  background: rgba(255,255,255,0.05);
  border-top-color:#444;
}
footer small {
  display:block;
  opacity:0.6;
  margin-top:5px;
  font-size:0.9em;
}

/* WARNINGS */
.warning { color:#d00; font-weight:700; margin-top:10px; }
body.dark .warning { color:#ff7c7c; }

/* RESPONSIVE */
@media(max-width:600px){
  header h1{font-size:1.5em;}
  .btn{padding:8px 15px;}
  table{font-size:0.9em; overflow-x:auto; display:block;}
}
</style>
</head>
<body>
<header>
  <h1>Smart Lighting Planner Premium</h1>
  <p>Hitung Lampu, Layout, Watt &amp; MCB dengan Akurasi SNI</p>
  <button id="toggleDark">ðŸŒ™</button>
</header>

<div class="wrap">
  <div class="card" style="text-align:center;">
    <button class="btn mode-btn active" id="btnMode1">Lampu per titik</button>
    <button class="btn mode-btn" id="btnMode2">KKK & lampu; MCB</button>
  </div>

  <!-- MODE 1 -->
  <div id="mode1" class="card">
    <div class="grid-2">
      <div>
        <label>Kategori Ruangan</label>
        <select id="kategori"></select>
      </div>
      <div>
        <label>Jenis Ruangan</label>
        <select id="ruangan"></select>
      </div>
      <div>
        <label>Panjang (m)</label>
        <input type="number" id="length" placeholder="5">
      </div>
      <div>
        <label>Lebar (m)</label>
        <input type="number" id="width" placeholder="4">
      </div>
      <div>
        <label>Efisiensi Î·</label>
        <input type="number" id="eta" value="0.8" step="0.01">
      </div>
      <div>
        <label>Pilih Lampu</label>
        <select id="lampSelect"></select>
      </div>
    </div>
    <button class="btn primary" id="calcMode1">Hitung &amp; Layout</button>
    <button class="btn outline" id="reset1">Reset</button>
    <div class="warning hidden" id="warning1"></div>
    <div id="resultMode1" class="result-block"></div>
    <svg id="lampLayout" viewBox="0 0 600 400"></svg>
  </div>

  <!-- MODE 2 (lanjutan di Part 2) -->
  <div id="mode2" class="card hidden">
    <div id="groupsContainer"></div>
    <button class="btn outline" id="addGroup">âž• Tambah Grup Lampu</button>
    <button class="btn primary" id="calcMode2">Hitung Mode 2</button>
    <div id="resultMode2" class="result-block"></div>
    <div style="overflow-x:auto;">
      <table id="resultTable">
        <thead>
          <tr><th>Grup</th><th>Jumlah Lampu</th><th>Lampu</th><th>Total Watt</th><th>Total VA</th><th>Arus (A)</th><th>Rek. MCB</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<footer>
  âš¡ Smart Lighting Planner Premium â€” by @bah
  <small>&copy; <span id="year"></span> All rights reserved.</small>
</footer>

<script>
// ===== DARK MODE + MEMORY =====
const toggleDark=document.getElementById('toggleDark');
if(localStorage.getItem('darkMode')==='true'){document.body.classList.add('dark');toggleDark.textContent='â˜€ï¸';}
toggleDark.addEventListener('click',()=>{
  document.body.classList.toggle('dark');
  const isDark=document.body.classList.contains('dark');
  toggleDark.textContent=isDark?'â˜€ï¸':'ðŸŒ™';
  localStorage.setItem('darkMode',isDark);
});

// ====== DATA ROOM & LAMPS ======
const ROOMS=[
 {key:"teras_rumah", name:"Teras (Rumah Tinggal). lux: 100", kategori:"Rumah Tinggal. lux:100", lux:100},
  {key:"ruang_tamu", name:"Ruang Tamu (Rumah Tinggal). lux: 150", kategori:"Rumah Tinggal. lux:150", lux:150},
  {key:"kamar_tidur", name:"Kamar Tidur (Rumah Tinggal). lux: 150", kategori:"Rumah Tinggal. lux:150", lux:150},
  {key:"dapur", name:"Dapur (Rumah Tinggal). lux: 250", kategori:"Rumah Tinggal. lux:250", lux:250},
  {key:"garasi", name:"Garasi (Rumah Tinggal). lux: 75", kategori:"Rumah Tinggal. lux:75", lux:75},
  {key:"koridor_rumah", name:"Koridor (Rumah Tinggal). lux: 100", kategori:"Rumah Tinggal. lux:100", lux:100},

  {key:"ruang_rapat", name:"Ruang Rapat (Perkantoran). lux: 300", kategori:"Perkantoran. lux:300", lux:300},
  {key:"ruang_direktur", name:"Ruang Direktur (Perkantoran). lux: 350", kategori:"Perkantoran. lux:350", lux:350},
  {key:"open_office", name:"Open Office (Perkantoran). lux: 350", kategori:"Perkantoran. lux:350", lux:350},
  {key:"ruang_komputer", name:"Ruang Komputer (Perkantoran). lux: 500", kategori:"Perkantoran. lux:500", lux:500},
  {key:"resepsionis", name:"Resepsionis (Perkantoran). lux: 300", kategori:"Perkantoran. lux:300", lux:300},

  {key:"kelas", name:"Ruang Kelas (Lembaga Pendidikan). lux: 300", kategori:"Lembaga Pendidikan. lux:300", lux:300},
  {key:"lab_komputer", name:"Laboratorium Komputer (Lembaga Pendidikan). lux: 500", kategori:"Lembaga Pendidikan. lux:500", lux:500},
  {key:"perpustakaan", name:"Perpustakaan (Lembaga Pendidikan). lux: 300", kategori:"Lembaga Pendidikan. lux:300", lux:300},
  {key:"ruang_gambar", name:"Ruang Gambar (Lembaga Pendidikan). lux: 750", kategori:"Lembaga Pendidikan. lux:750", lux:750},

  {key:"kamar_hotel", name:"Kamar Hotel (Hotel & Restoran). lux: 150", kategori:"Hotel & Restoran. lux:150", lux:150},
  {key:"lobi_hotel", name:"Lobi Hotel (Hotel & Restoran). lux: 200", kategori:"Hotel & Restoran. lux:200", lux:200},
  {key:"ruang_makan", name:"Ruang Makan (Hotel & Restoran). lux: 200", kategori:"Hotel & Restoran. lux:200", lux:200},
  {key:"dapur_restoran", name:"Dapur Restoran (Hotel & Restoran). lux: 500", kategori:"Hotel & Restoran. lux:500", lux:500},

  {key:"ruang_operasi", name:"Ruang Operasi (Rumah Sakit). lux: 1000", kategori:"Rumah Sakit. lux:1000", lux:1000},
  {key:"icu", name:"ICU (Rumah Sakit). lux: 300", kategori:"Rumah Sakit. lux:300", lux:300},
  {key:"rawat_inap", name:"Ruang Rawat Inap (Rumah Sakit). lux: 200", kategori:"Rumah Sakit. lux:200", lux:200},
  {key:"lab_klinik", name:"Laboratorium Klinik (Rumah Sakit). lux: 750", kategori:"Rumah Sakit. lux:750", lux:750},

  {key:"produksi_kasar", name:"Produksi Kasar (Industri). lux: 200", kategori:"Industri. lux:200", lux:200},
  {key:"perakitan_presisi", name:"Perakitan Presisi (Industri). lux: 1000", kategori:"Industri. lux:1000", lux:1000},
  {key:"gudang", name:"Gudang (Industri). lux: 150", kategori:"Industri. lux:150", lux:150},
  {key:"ruang_kontrol", name:"Ruang Kontrol (Industri). lux: 500", kategori:"Industri. lux:500", lux:500},

  {key:"supermarket", name:"Supermarket (Pertokoan & Mall). lux: 750", kategori:"Pertokoan & Mall. lux:750", lux:750},
  {key:"etalase", name:"Etalase / Display (Pertokoan & Mall). lux: 1000", kategori:"Pertokoan & Mall. lux:1000", lux:1000},
  {key:"area_kasir", name:"Area Kasir (Pertokoan & Mall). lux: 500", kategori:"Pertokoan & Mall. lux:500", lux:500},
  {key:"foodcourt", name:"Foodcourt (Pertokoan & Mall). lux: 300", kategori:"Pertokoan & Mall. lux:300", lux:300},

  {key:"jalan_utama", name:"Jalan Utama (Outdoor). lux: 20", kategori:"Jalan & Transportasi. lux:20", lux:20},
  {key:"jalan_lingkungan", name:"Jalan Lingkungan (Outdoor). lux: 10", kategori:"Jalan & Transportasi. lux:10", lux:10},
  {key:"terminal", name:"Terminal (Jalan & Transportasi). lux: 150", kategori:"Jalan & Transportasi. lux:150", lux:150},
  {key:"bandara", name:"Bandara / Ruang Tunggu (Jalan & Transportasi). lux: 300", kategori:"Jalan & Transportasi. lux:300", lux:300}
];

const LAMPS = [
  {index:0,name:"LED Philips 3W. lumen: 240",watt:3,lumen:240},
  {index:1,name:"LED Philips 5W. lumen: 450",watt:5,lumen:450},
  {index:2,name:"LED Philips 7W. lumen: 600",watt:7,lumen:600},
  {index:3,name:"LED Philips 9W. lumen: 800",watt:9,lumen:800},
  {index:4,name:"LED Philips 12W. lumen: 1055",watt:12,lumen:1055},
  {index:5,name:"LED Philips 15W. lumen: 1300",watt:15,lumen:1300},
  {index:6,name:"LED Osram 10W. lumen: 900",watt:10,lumen:900},
  {index:7,name:"LED Osram 20W. lumen: 1800",watt:20,lumen:1800},
  {index:8,name:"Downlight LED 12W. lumen: 1000",watt:12,lumen:1000},
  {index:9,name:"Downlight LED 18W. lumen: 1500",watt:18,lumen:1500},
  {index:10,name:"Lampu TL 36W. lumen: 3350",watt:36,lumen:3350},
  {index:11,name:"Lampu TL 58W. lumen: 4000",watt:58,lumen:4000},
  {index:12,name:"Floodlight LED 30W. lumen: 2700",watt:30,lumen:2700},
  {index:13,name:"Floodlight LED 50W. lumen: 4500",watt:50,lumen:4500},
  {index:14,name:"Floodlight LED 70W. lumen: 6300",watt:70,lumen:6300},
  {index:15,name:"Floodlight LED 100W. lumen: 9000",watt:100,lumen:9000},
  {index:16,name:"Spotlight LED 5W. lumen: 400",watt:5,lumen:400},
  {index:17,name:"Spotlight LED 10W. lumen: 900",watt:10,lumen:900}
];


// === Dropdown dynamic
const kategoriEl=document.getElementById("kategori");
const ruanganEl=document.getElementById("ruangan");
const lampSelect=document.getElementById("lampSelect");

const kategoriList=[...new Set(ROOMS.map(r=>r.kategori))];
kategoriList.forEach(k=>{
  const opt=document.createElement("option");
  opt.value=k; opt.textContent=k;
  kategoriEl.appendChild(opt);
});
kategoriEl.addEventListener("change",()=>{
  ruanganEl.innerHTML='<option value="">-- Pilih Ruangan --</option>';
  ROOMS.filter(r=>r.kategori==kategoriEl.value).forEach(r=>{
    const o=document.createElement("option");
    o.value=r.key; o.textContent=r.name;
    ruanganEl.appendChild(o);
  });
});
LAMPS.forEach(l=>{
  const o=document.createElement("option");
  o.value=l.index;
  o.textContent=l.name+` [${l.watt}W | ${l.lumen}lm]`;
  lampSelect.appendChild(o);
});

// === Mode toggle
const mode1=document.getElementById("mode1");
const mode2=document.getElementById("mode2");
const btn1=document.getElementById("btnMode1");
const btn2=document.getElementById("btnMode2");
btn1.onclick=()=>{mode1.classList.remove('hidden');mode2.classList.add('hidden');btn1.classList.add('active');btn2.classList.remove('active');};
btn2.onclick=()=>{mode2.classList.remove('hidden');mode1.classList.add('hidden');btn2.classList.add('active');btn1.classList.remove('active');};

// === Mode 1 Hitung
document.getElementById("calcMode1").onclick=()=>{
  const rKey=ruanganEl.value;
  const lIdx=parseInt(lampSelect.value);
  const len=parseFloat(document.getElementById("length").value);
  const wid=parseFloat(document.getElementById("width").value);
  const eta=parseFloat(document.getElementById("eta").value);
  const warn=document.getElementById("warning1");
  const result=document.getElementById("resultMode1");
  const svg=document.getElementById("lampLayout");
  if(!rKey||isNaN(lIdx)||!len||!wid){alert("Lengkapi semua input!");return;}
  const ruangan=ROOMS.find(r=>r.key==rKey);
  const lamp=LAMPS.find(l=>l.index==lIdx);
  const area=len*wid;
  const totalLum=ruangan.lux*area/eta;
  const lampCount=Math.ceil(totalLum/lamp.lumen);
  const totalWatt=lamp.watt*lampCount;
  const arus=totalWatt/220;
  const cols=Math.ceil(Math.sqrt(lampCount)),rows=Math.ceil(lampCount/cols);
  svg.innerHTML="";
  for(let i=0;i<lampCount;i++){
    const r=Math.floor(i/cols),c=i%cols;
    const cx=((c+1)/(cols+1))*600;
    const cy=((r+1)/(rows+1))*400;
    const circle=document.createElementNS("http://www.w3.org/2000/svg","circle");
    circle.setAttribute("cx",cx);
    circle.setAttribute("cy",cy);
    circle.setAttribute("r",10);
    circle.setAttribute("fill",i%2==0?"#9d7df5":"#7c3aed");
    svg.appendChild(circle);
  }
  warn.classList.add("hidden");
  if(lampCount%cols!==0){
    warn.textContent="Peringatan: jumlah lampu tidak simetris, sesuaikan tata letak.";
    warn.classList.remove("hidden");
  }
  result.innerHTML=
    `Ruangan: ${ruangan.name}\n`+
    `Luas: ${area.toFixed(2)} mÂ²\n`+
    `Kebutuhan cahaya: ${totalLum.toFixed(0)} lumen\n`+
    `Lampu dipilih: ${lamp.name}\n`+
    `Jumlah lampu: ${lampCount}\n`+
    `Total daya: ${totalWatt.toFixed(1)} W\n`+
    `Arus total: ${arus.toFixed(2)} A`;
};

document.getElementById("reset1").onclick=()=>{
  document.getElementById("resultMode1").innerHTML="";
  document.getElementById("lampLayout").innerHTML="";
  document.getElementById("warning1").classList.add("hidden");
};

// Footer year
document.getElementById("year").textContent=new Date().getFullYear();
</script>
</body>
</html>

<script>
// ===== MODE 2 (Hitung KKK & MCB) =====
const groupsContainer = document.getElementById("groupsContainer");
const addGroupBtn = document.getElementById("addGroup");
const resultTableBody = document.querySelector("#resultTable tbody");
const resultMode2 = document.getElementById("resultMode2");

// simpan semua grup di array
let groups = [];
let groupIndex = 1;

// Tambah grup
addGroupBtn.addEventListener("click", () => {
  const div = document.createElement("div");
  div.className = "card";
  div.innerHTML = `
    <h3>Grup Lampu ${groupIndex}</h3>
    <div class="grid-2">
      <div>
        <label>Jumlah Lampu</label>
        <input type="number" class="lampCount" placeholder="Contoh: 10" min="1">
      </div>
      <div>
        <label>Pilih Lampu</label>
        <select class="lampType">
          ${LAMPS.map(l => `<option value="${l.index}">${l.name} [${l.watt}W]</option>`).join("")}
        </select>
      </div>
    </div>
  `;
  groupsContainer.appendChild(div);
  groups.push({ id: groupIndex, countEl: div.querySelector(".lampCount"), typeEl: div.querySelector(".lampType") });
  groupIndex++;
});

// Tombol hitung mode 2
document.getElementById("calcMode2").addEventListener("click", () => {
  resultTableBody.innerHTML = "";
  let totalWattAll = 0, totalVAAll = 0, totalAAll = 0;
  resultMode2.textContent = "";

  groups.forEach((g, i) => {
    const count = parseInt(g.countEl.value);
    const lamp = LAMPS.find(l => l.index == g.typeEl.value);
    if (isNaN(count) || count <= 0) return;

    const totalWatt = count * lamp.watt;
    const totalVA = totalWatt / 0.85; // asumsi pf=0.85
    const arus = totalWatt / 220;
    const mcb = arus <= 6 ? "6A" : arus <= 10 ? "10A" : arus <= 16 ? "16A" : arus <= 20 ? "20A" : "25A";

    totalWattAll += totalWatt;
    totalVAAll += totalVA;
    totalAAll += arus;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>Grup ${i + 1}</td>
      <td>${count}</td>
      <td>${lamp.name}</td>
      <td>${totalWatt.toFixed(1)}</td>
      <td>${totalVA.toFixed(1)}</td>
      <td>${arus.toFixed(2)}</td>
      <td>${mcb}</td>
    `;
    resultTableBody.appendChild(row);
  });

  if (groups.length === 0) {
    alert("Tambahkan grup dulu!");
    return;
  }

  resultMode2.textContent = `
Total Keseluruhan:
  Total Daya (W): ${totalWattAll.toFixed(1)} W
  Total VA: ${totalVAAll.toFixed(1)} VA
  Total Arus: ${totalAAll.toFixed(2)} A
  Rekomendasi MCB Utama: ${totalAAll <= 6 ? "6A" : totalAAll <= 10 ? "10A" : totalAAll <= 16 ? "16A" : totalAAll <= 20 ? "20A" : "25A"}
  Jumlah Grup: ${groups.length}
  `;
});

// ===== EXPORT TO EXCEL =====
const exportExcelBtn = document.createElement("button");
exportExcelBtn.className = "btn outline";
exportExcelBtn.textContent = "ðŸ“Š Ekspor ke Excel";
resultMode2.parentElement.appendChild(exportExcelBtn);

exportExcelBtn.addEventListener("click", () => {
  if (resultTableBody.rows.length === 0) return alert("Belum ada data untuk diekspor!");
  let csv = "Grup,Jumlah Lampu,Lampu,Total Watt,Total VA,Arus (A),MCB\n";
  for (const r of resultTableBody.rows) {
    const cols = [...r.children].map(td => td.textContent);
    csv += cols.join(",") + "\n";
  }
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "SmartLightingPlanner.csv";
  a.click();
  URL.revokeObjectURL(url);
});

// ===== EXPORT TO PDF =====
const exportPdfBtn = document.createElement("button");
exportPdfBtn.className = "btn outline";
exportPdfBtn.textContent = "ðŸ“„ Ekspor ke PDF";
resultMode2.parentElement.appendChild(exportPdfBtn);

exportPdfBtn.addEventListener("click", () => {
  if (resultTableBody.rows.length === 0) return alert("Belum ada data untuk diekspor!");
  const printWin = window.open("", "", "width=900,height=700");
  const content = `
    <html>
    <head><title>Smart Lighting Planner PDF</title></head>
    <body style="font-family:sans-serif;">
      <h2 style="text-align:center;">Smart Lighting Planner Premium</h2>
      <p>${resultMode2.textContent.replace(/\n/g,"<br>")}</p>
      <table border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;">
        <thead style="background:#7c3aed;color:#fff;">
          <tr><th>Grup</th><th>Jumlah Lampu</th><th>Lampu</th><th>Total Watt</th><th>Total VA</th><th>Arus (A)</th><th>MCB</th></tr>
        </thead>
        <tbody>${resultTableBody.innerHTML}</tbody>
      </table>
      <p style="text-align:center;margin-top:20px;opacity:0.6;">Smart Lighting Planner Premium â€” by @bah</p>
    </body>
    </html>
  `;
  printWin.document.write(content);
  printWin.document.close();
  printWin.print();
});
</script>
